

# 修复大批量照片上传中断问题

## 问题分析

当前上传逻辑是**逐张串行上传**（`for...of` 循环），36 张照片依次排队，总耗时长，容易因网络波动或连接超时导致中途失败。

## 修复方案

### 核心思路：并发上传 + 重试机制

将串行上传改为**并发分批上传**，同时为每个文件添加重试逻辑，大幅提高成功率和速度。

### 文件：`src/components/PhotoWall.tsx`

| 项目 | 当前值 | 修改后 |
|------|--------|--------|
| 单张大小限制 | 5MB | 6MB |
| 上传方式 | 串行（逐张） | 并发（最多 6 张同时上传） |
| 失败重试 | 无 | 每张最多重试 2 次 |
| 进度反馈 | 仅最终结果 | 实时显示进度（如 "正在上传 12/36..."） |

### 技术细节

1. **提取上传单张照片的函数** `uploadSinglePhoto(file)`，内含验证、压缩、上传逻辑，失败时自动重试最多 2 次（间隔 1 秒）。

2. **并发控制器**：使用 `Promise` 池模式，维持最多 6 个并发上传任务，避免同时发起 36 个请求导致浏览器/服务器过载。

3. **实时进度**：添加 `uploadProgress` 状态，在上传按钮旁显示 "正在上传 X/Y..."。

4. **单张大小限制**调整为 6MB。

```text
修改前（串行）：
  文件1 → 文件2 → 文件3 → ... → 文件36
  总时间 = 36 x 单张时间

修改后（6路并发）：
  [文件1, 文件2, ..., 文件6] → [文件7, ..., 文件12] → ...
  总时间 ≈ 6 x 单张时间（快 6 倍）
```

不需要创建后端函数，直接利用现有的存储服务 API 即可完成。

